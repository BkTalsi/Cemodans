<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talsi 2025 - Match Matrix</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script>
        const sheetID = "1TpX7oRId-a7WD1PFH7aJoR9y6ConYYIWwWOYwMOmO-k";
        const gid = "187862000";
        const apiURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&gid=${gid}`;

        const teams = ["TALSI", "TUKUMS", "DOBELE", "CÄ’SIS"];

        async function fetchData() {
            try {
                const response = await fetch(apiURL);
                const text = await response.text();
                const jsonText = text.match(/\{.*\}/s)?.[0];
                if (!jsonText) return;

                const data = JSON.parse(jsonText);
                const rows = data.table.rows;
                const results = {};

                rows.forEach(row => {
                    const teamA = row.c[4]?.v;
                    const teamB = row.c[7]?.v;
                    let scoreA = row.c[5]?.v;
                    let scoreB = row.c[6]?.v;

                    const zA = scoreA === 'z';
                    const zB = scoreB === 'z';

                    if (teamA && teamB) {
                        if (zA && !zB) {
                        scoreA = 0;
                        scoreB = 20;
                    } else if (zB && !zA) {
                        scoreA = 20;
                        scoreB = 0;
                    }
                    
                    // Adjust points for 'z' cases
                    const pointsA = zA ? 0 : (scoreA > scoreB ? 2 : 1);
                    const pointsB = zB ? 0 : (scoreB > scoreA ? 2 : 1);
                    
                    // If one is 'z', ensure correct points assignment
                    if (zA && !zB) {
                        pointsA = 0;
                        pointsB = 2;
                    }
                    if (zB && !zA) {
                        pointsA = 2;
                        pointsB = 0;
                    }

                        const scoreStrA = `${scoreA ?? ''}:${scoreB ?? ''}`;
                        const scoreStrB = `${scoreB ?? ''}:${scoreA ?? ''}`;

                        const pointsA = zA ? 0 : (scoreA > scoreB ? 2 : 1);
                        const pointsB = zB ? 0 : (scoreB > scoreA ? 2 : 1);

                        results[`${teamA}-${teamB}`] = { result: scoreStrA, points: pointsA };
                        results[`${teamB}-${teamA}`] = { result: scoreStrB, points: pointsB };
                    }
                });

                let tableHTML = `<table class="table table-bordered text-center">
                                    <thead>
                                        <tr><th></th>${teams.map(t => `<th>${t}</th>`).join('')}<th>PUNKTI</th><th>VIETA</th></tr>
                                    </thead>
                                    <tbody>`;

                teams.forEach((rowTeam, rowIndex) => {
                    tableHTML += `<tr><th>${rowTeam}</th>`;
                    teams.forEach((colTeam, colIndex) => {
                        if (rowIndex === colIndex) {
                            tableHTML += `<td class="bg-secondary"></td>`;
                        } else {
                            const match = results[`${rowTeam}-${colTeam}`];
                            if (match) {
                                const displayResult = match.result === ':' ? `<strong>0</strong><br>:` : `<strong>${match.points}</strong><br>${match.result}`;
                                tableHTML += `<td>${displayResult}</td>`;
                            } else {
                                tableHTML += `<td><strong>0</strong><br>:</td>`;
                            }
                        }
                    });
                    tableHTML += `<td></td><td></td></tr>`;
                });

                tableHTML += `</tbody></table>`;

                document.getElementById("matrix-container").innerHTML = tableHTML;

            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }
        setInterval(fetchData, 5000); // Refresh data every 5 seconds
        window.onload = fetchData;
    </script>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h2 class="text-center">ðŸ“Š Talsi 2025 - Match Matrix</h2>
        <div id="matrix-container"></div>
    </div>
</body>
</html>
