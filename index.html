const sheetID = "1TpX7oRId-a7WD1PFH7aJoR9y6ConYYIWwWOYwMOmO-k";
const gid = "187862000";
const query = encodeURIComponent("select A, C"); // Fetch only columns A & C
const apiURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&gid=${gid}&tq=${query}`;

async function fetchData() {
    try {
        const response = await fetch(apiURL);
        const text = await response.text();
        const jsonText = text.match(/\{.*\}/s)?.[0]; 
        if (!jsonText) return;

        const data = JSON.parse(jsonText);
        const headers = data.table.cols.map(col => col.label || ""); // Get headers

        function formatCell(cell) {
            if (!cell || cell.v === undefined) return ""; 
            if (typeof cell.v === "number" && cell.f) return cell.f; 
            return cell.v; 
        }

        const rows = data.table.rows.map(row => row.c.map(formatCell));

        // Generate table
        let table = `<table class="table table-striped table-bordered mt-3">
                        <thead class="table-dark"><tr>`;
        headers.forEach(header => table += `<th>${header}</th>`);
        table += `</tr></thead><tbody>`;

        rows.forEach(row => {
            table += "<tr>";
            row.forEach(cell => table += `<td>${cell}</td>`);
            table += "</tr>";
        });

        table += "</tbody></table>";

        document.getElementById("table-container").innerHTML = table;
    } catch (error) {
        console.error("Error fetching data:", error);
    }
}

setInterval(fetchData, 5000);
window.onload = fetchData;
