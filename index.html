<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets Table</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
    </style>
    <script>
        const sheetID = "1TpX7oRId-a7WD1PFH7aJoR9y6ConYYIWwWOYwMOmO-k"; // Your actual Google Sheet ID
        const gid = "187862000";  // Your actual GID (tab ID)
        const apiURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&gid=${gid}`;

        let previousData = ""; // Store last known data

        async function fetchData() {
            try {
                console.log("Fetching data...");

                const response = await fetch(apiURL);
                const text = await response.text();

                // Extract JSON from Google's response
                const jsonText = text.match(/\{.*\}/s)?.[0]; 
                if (!jsonText) {
                    console.warn("Invalid JSON response from Google Sheets.");
                    return;
                }

                const data = JSON.parse(jsonText);
                const rows = data.table.rows.map(row => row.c.map(cell => cell?.v || "")); // Extract values

                // Build HTML table
                let table = "<table>";
                rows.forEach((row, index) => {
                    table += "<tr>";
                    row.forEach(cell => {
                        table += index === 0 ? `<th>${cell}</th>` : `<td>${cell}</td>`;
                    });
                    table += "</tr>";
                });
                table += "</table>";

                // Only update if new data is different
                if (table !== previousData) {
                    document.getElementById("table-container").innerHTML = table;
                    previousData = table;
                    console.log("Table updated.");
                } else {
                    console.log("No changes detected.");
                }
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        setInterval(fetchData, 5000); // Refresh every 5 seconds
        window.onload = fetchData;
    </script>
</head>
<body>
    <h2>Live Google Sheets Table</h2>
    <div id="table-container"></div>
</body>
</html>
